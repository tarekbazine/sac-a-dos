<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Algorithme detaillé</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <!--/***************************************-->
    <!--***BAZINE Tarek - CHIKHAISSA Mahfoud****-->
    <!--****ESI 2017/18 TPGO TP1****-->
    <!--****************************************/-->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/jquery-ui.min.css" type="text/css">
    <style>
        @font-face {
            font-family: 'Changa';
            src: url('css/fonts/Changa-Regular.ttf') format('truetype');
        }

        body {
            font-family: 'Changa', sans-serif;
            font-size: 1.7em;

            background-image: url('img/background-details.jpg');
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
        }

        .table {
            width: auto !important;
        }

        .center-block {
            display: table !important;
        }

        .table {
            border: 0.5px solid #000000;
        }

        .table-bordered > thead > tr > th,
        .table-bordered > tbody > tr > th,
        .table-bordered > tfoot > tr > th,
        .table-bordered > thead > tr > td,
        .table-bordered > tbody > tr > td,
        .table-bordered > tfoot > tr > td {
            border: 0.5px solid #000000;
        }
    </style>
</head>

<body>

<header>
    <nav class="navbar navbar-inverse navbar-static-top">
        <div class="container">
            <div class="row align-items-center">
                <div class="col col-xs-3 col-sm-2 col-lg-1 col-md-1 center-block ">
                    <a href="index.html"><img src="img/knapsack.png" alt="knapsack" class="img-responsive"></a>
                </div>
                <div class="col col-lg-4 col-sm-3 col-md-4  bg-succes bg-succes text-primary center-block ">
                    <h2>SAC-A-DOS Résolvant</h2>
                </div>
                <div class="col col-sm-1 col-md-3 col-lg-3  "></div>
                <div class="col col-sm-4 col-md-4 col-lg-4 " style="margin-top: 25px">
                    <button type="button" class="btn btn-primary btn-block" data-toggle="modal" data-target="#aprpos">A
                        propos
                    </button>
                </div>
            </div>
        </div>
    </nav>
</header>

<!-- Modal -->
<div class="modal fade" id="aprpos" role="dialog" style="">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"><b>SAC-A-DOS Résolvant</b></h4>
            </div>
            <div class="modal-body">
                <p><b>Développé par:</b><br>
                    BAZINE Tarek <br>
                    CHIKH AISSA Mahfoud <br><br>
                    <b>Dirigé par:</b><br>
                    M. HADIM B<br><br>
                    Tous les droits sont réservés ESI/SIL-2017</p>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- page bady -->
<div class="container-fluid">
    <div class="row">
        <h3 class="col-md-3 col-md-offset-4"
            style="text-decoration: underline;">Entrees:</h3>
    </div>

    <div class="row text-center">

        <div class="col-md-7">
            <table class="table table-bordered pull-right">

                <tbody id="arr-input">
                <tr id="v-arr">
                    <th scope="row">v</th>
                </tr>
                <tr id="w-arr">
                    <th scope="row">w</th>
                </tr>
                </tbody>

            </table>
        </div>

        <div class="col-md-5">
            <table class="table table-bordered">

                <tbody>
                <tr>
                    <th scope="row">W</th>
                    <td id="W-val"></td>
                </tr>
                </tbody>

            </table>
        </div>
    </div>

    <div class="row">
        <h3 class="col-md-3 col-md-offset-4"
            style="text-decoration: underline;">Sorties:</h3>
    </div>
    <div class="row text-center">

        <table class="table table-bordered center-block">

            <thead>
            <tr id="j">
                <th>i \ j</th>
            </tr>
            </thead>

            <tbody id="arr-body">

            </tbody>

        </table>
    </div>
    <br>
    <div id="solution" class="" style="display: none">
        <h2 class="col-md-offset-3 col-md-6">
            <span style="text-decoration: underline;">Solutions: </span>
            <span style="font-size: 0.7em;text-decoration: none;">&nbsp; les objets selectionés</span></h2>
        <div class="row">
            <div id="slc-obj" class="col-md-offset-3 col-md-6">

            </div>
        </div>
    </div>
    <div class="row">
        <h2 class="col-md-offset-3 col-md-6"
            style="text-decoration: underline;">Algorithme:</h2>
        <div class="col-md-3">
            <input value="0.5" id="spinner" style="width: 70px;"/>
        </div>
    </div>
    <div class="row">
        <div class="col-md-offset-3 col-md-6 first-loop">
            Pour i allant de 1 a N
        </div>
    </div>
    <div class="row">
        <div class="col-md-offset-3 col-md-6 first-loop">
            &nbsp;&nbsp;Faire
        </div>
    </div>
    <div class="row">
        <div class="col-md-offset-3 col-md-6 scnd-loop">
            &nbsp;&nbsp;&nbsp;&nbsp; Pour j allant de 0 a W
        </div>
    </div>
    <div class="row">
        <div class="col-md-offset-3 col-md-6 scnd-loop">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Faire
        </div>
    </div>
    <div class="row">
        <div class="col-md-offset-3 col-md-6 if-wi">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Si w[i] > j Alors mat[i][j] = mat[i - 1][j];
        </div>
    </div>
    <div class="row">
        <div class="col-md-offset-3 col-md-6 if-max">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sinon mat[i][j] = max(v[i] + mat[i - 1][j - w[i]], mat[i -
            1][j]);
        </div>
    </div>
    <div class="row">
        <div class="col-md-offset-3 col-md-6 scnd-loop">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fpour
        </div>
    </div>
    <div class="row">
        <div class="col-md-offset-3 col-md-6 first-loop">
            &nbsp;&nbsp; Fpour
        </div>
    </div>

</div>

<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.js"></script>
<script type="text/javascript">
    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    function max(a, b) {
        if (a > b) return a;
        return b;
    }

    async function draw() {

        var algo_speed= 500;

        function isNumber(n){
            return typeof(n) != "boolean" && !isNaN(n);
        }

        /*init spinner*/
        $(function() {
            $('#spinner').spinner({
                min: 0,
                max: 200,
                step: 0.5,
                spin: function( event, ui ) {
                    console.log(ui);
                    console.log(ui.value);
                    if(!isNumber(ui.value)){
                        alert('plz take avilid number !!');
                        location = location;
                    }
                    algo_speed = parseInt(ui.value)*1000;
                }
            });
        });
        /*end init spinner*/

        var N = parseInt($.cookie('N'));
        var W = parseInt($.cookie('W'));

        /*algorithme's sructures*/
        var w = JSON.parse($.cookie('w'));
        var v = JSON.parse($.cookie('v'));

        //remove cookies
        $.removeCookie("W");
        $.removeCookie("N");
        $.removeCookie("w");
        $.removeCookie("v");

        //draw inputs table
        $('#W-val').text(W);
        for (var j = 0; j < N; j++) {
            $('#v-arr').append('<td>' + v[j] + '</td>');
            $('#w-arr').append('<td>' + w[j] + '</td>');
        }

        //draw a blanc table
        for (var j = 0; j <= W; j++) {
            $('#j').append('<th>' + j + '</th>');
        }
        for (var i = 1; i <= N; i++) {
            $('#arr-body').append('<tr id="i' + i + '">' +
                    '<th scope="row">' + i + '</th>' +
                    '</tr>');
            for (var j = 0; j <= W; j++) {
                $('#i' + i).append('<th> </th>');
            }
        }

        var mat = [];

        // js array two dimension building
        for (var j = 0; j <= W; j++) {
            mat[j] = [];
        }

        /*init matrix*/
        var th;
        for (var i = 0; i < N; i++) {
            th = $('#i' + (i + 1) + ' > th')[1];
            th.innerHTML = "0";
            mat[i][0] = 0;
        }

        var row,
                frst_loop = $('.first-loop'),
                scnd_loop = $('.scnd-loop'),
                if_wi = $(".if-wi"),
                if_max = $('.if-max');
        //this an optimization ???!! we deleting a not-needed row
        row1 = $('#i1 > th');
        frst_loop.css('backgroundColor', '#92a8d1');
        await sleep(algo_speed);
        frst_loop.css('backgroundColor', '');
        for (var j = 1; j <= W; j++) {
            scnd_loop.css('backgroundColor', '#80ced6');
            await sleep(algo_speed);
            scnd_loop.css('backgroundColor', '');
            if (w[0] > j) {
                if_wi.css('backgroundColor', '#f18973');
                row1[j + 1].style.backgroundColor = '#f18973';
                row1[j + 1].innerHTML = 0;
                await sleep(algo_speed);
                mat[0][j] = 0;
                if_wi.css('backgroundColor', '');
            } else {
                if_max.css('backgroundColor', '#82b74b');
                row1[j + 1].style.backgroundColor = '#82b74b';
                row1[j + 1].innerHTML = w[0];
                mat[0][j] = v[0];
                await sleep(algo_speed);
                if_max.css('backgroundColor', '');
            }
            row1[j + 1].style.backgroundColor = '';
        }

        for (var i = 1; i < N; i++) {
            row = $('#i' + (i + 1) + ' > th');
            frst_loop.css('backgroundColor', '#92a8d1');
            await sleep(algo_speed);
            frst_loop.css('backgroundColor', '');
            for (var j = 0; j <= W; j++) {
                scnd_loop.css('backgroundColor', '#80ced6');
                await sleep(algo_speed);
                scnd_loop.css('backgroundColor', '');
                if (w[i] > j) {
                    mat[i][j] = mat[i - 1][j];
                    if_wi.css('backgroundColor', '#f18973');
                    row[j + 1].style.backgroundColor = '#f18973';
                    await sleep(algo_speed);
                    if_wi.css('backgroundColor', '');
                } else {
                    mat[i][j] = max(v[i] + mat[i - 1][j - w[i]], mat[i - 1][j]);
                    if_max.css('backgroundColor', '#82b74b');
                    row[j + 1].style.backgroundColor = '#82b74b';
                    await sleep(algo_speed);
                    if_max.css('backgroundColor', '');
                }
                row[j + 1].innerHTML = mat[i][j];
                row[j + 1].style.backgroundColor = '';
            }
        }



        //printing results
        //list of the selected objects
        var selectedOject = [];
        var j = W, selected_objs = $('#slc-obj');
        $('#solution').show();
        for (var i = N - 1; i > 0; i--) {
            row = $('#i' + (i + 1) + ' > th');
            row[j + 1].style.backgroundColor = '#77a8a8';
            await sleep(algo_speed);
            if ((mat[i][j] == 0)) {
                console.log("fin");
                break;
            }
            if ((mat[i][j] != mat[i - 1][j])) {
                selectedOject.push(i);
                row[j + 1].style.backgroundColor = '#b5e7a0';
                console.log("object num " + (i + 1) + " has been selected \n");
                j = j - w[i];
                selected_objs.append('<span style="background-color: #b5e7a0;' +
                        'padding: 5px;margin: 5px">' +
                        'object ' + (i + 1) +
                        '</span>');
                continue;
            }
            row[j + 1].style.backgroundColor = '';
        }
        if ((mat[0][j] != 0)) {
            row = $('#i1 > th');
            row[j + 1].style.backgroundColor = '#b5e7a0';
            selected_objs.append('<span style="background-color: #b5e7a0;' +
                    'padding: 5px;margin: 5px">' +
                    'object 1' +
                    '</span>');
            selectedOject.push(0);
            console.log("object num 0 has been selected \n");
        }

    }

    draw();
</script>


</body>

</html>
